<!DOCTYPE html>
<html lang="en">
	<head>
		<title>20 Questions</title>
        <link rel="stylesheet" href="//ajax.googleapis.com/ajax/libs/jqueryui/1.10.4/themes/smoothness/jquery-ui.css" />
		<script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
        <script src="//ajax.googleapis.com/ajax/libs/jqueryui/1.10.4/jquery-ui.min.js"></script>
        
        <link rel="stylesheet" type="text/css" href="Style.css" />
        <link rel="stylesheet" type="text/css" href="20Questions/Style.css" />
        <script type="text/javascript" src="Constants.js"></script>
        <script type="text/javascript" src="Poller.js"></script>
        <script type="text/javascript" src="Logger.js"></script>
        <script type="text/javascript" src="API.js"></script>
        <script type="text/javascript" src="20Questions/Tree.js"></script>
		<script type="text/javascript">
			window.onload = function() {
                // Initialize the trial-starting buttons
                $('#QuestionsButton').button()
                .click(function() {
                    SubmitQuestion($('#QuestionsList > li.ui-selected'), true);
                });
                $('#AnswersButton').button()
                .click(function() {
                    SubmitQuestion($('#AnswersList > li.ui-selected'), false);
                });

                $('#FileSelectionPrompt').dialog({
                    autoOpen: true,
                    modal: true,
                    buttons: {
                        "Select" : function() {
                            InitializeQuestionTree('/20Questions/' + $('#FileSelector').val());
                            $(this).dialog("close");
                        }
                    }
                });

                $('#ConfirmationPrompt').dialog({
                    autoOpen: false, 
                    width: 350, 
                    modal: true,
                    buttons: {
                        "Yes" : function() {
                            //TODO
                            $(this).dialog("close");
                        },
                        "No" : function() {
                            //TODO
                            $(this).dialog("close");
                        }
                    }, 
                    open: function(event, ui) {
                        $('#ConfirmationText').show();
                        var buttons = $('#ConfirmationPrompt + .ui-dialog-buttonpane > .ui-dialog-buttonset');
                        
                        // Hide the buttons for a moment
                        buttons.hide();
                        
                        // Prevent the Yes/No prompt from being used until the trial is over
                        var counter = function() {
                            var ellipses = $('#ConfirmationEllipses');
                            
                            if (ellipses.text().length > TRIAL_TIME / 1000) {
                                $('#ConfirmationText').hide();
                                buttons.show();
                            } else {
                                ellipses.text(ellipses.text() + '.');
                                setTimeout(counter, 1000);
                            }
                        }
                        counter();
                    }
                });

                // Start polling the server for hits
                // PollServer();
			};

            /**
             * Takes the selected question/answer and asks the BCI-side for an answer
             */
            SubmitQuestion = function(selected, isQuestion) {
                // Anything selected?
                if (selected.length <= 0) {
                    return;
                }
                
                // Extract the question to ask
                var question = selected.filter(':first').text();
                if (!isQuestion) {
                    question = 'Is it a ' + question + '?';
                }
                
                // Ask the BCI for an answer
                POST_TrialStart(question, 
                    function() {
                        $('#ConfirmationPrompt').dialog("open");
                    }, 
                    function() {
                        alert('Application suspended, please try again in a moment');
                    });
            };
		</script>
	</head>
	<body tabindex="0">
        <div id="FileSelectionPrompt" title="Choose a question file:">
            <select id="FileSelector">
                <option value="question2.txt">Animals (minimal)</option>
                <option value="animals.txt">Animals</option>
                <option value="simple.txt">Simple</option>
            </select>
        </div>
        <div id="ConfirmationPrompt" title="Did you see a flash of light?">
            <div id="ConfirmationText">
                Waiting for answer<span id="ConfirmationEllipses"></span>
            </div>
        </div>
        <div id="QuestionsBox">
            <div id="QuestionsLabel">Questions</div>
            <ul id="QuestionsList"></ul>
            <div id="QuestionsButton">Submit</div>
        </div>
        <div id="AnswersBox">
            <div id="AnswersLabel">Answers</div>
            <ul id="AnswersList"></ul>
            <div id="AnswersButton">Submit</div>
        </div>
	</body>
</html>
