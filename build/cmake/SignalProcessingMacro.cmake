###########################################################################
## $Id$
## Authors: griffin.milsap@gmail.com
## Description: Contains a macro for creating a signal processing module

MACRO( BCI2000_ADD_SIGNAL_PROCESSING_MODULE NAME SOURCES HEADERS SIGPROCSOURCES SIGPROCHEADERS INCLUDES )

# DEBUG
MESSAGE( "-- Adding Signal Processing Project: " ${NAME} )

INCLUDE( ${BCI2000_CMAKE_DIR}/frameworks/DefaultSigProcFramework.cmake )

# Add the required signal processing files into the framework for this project
SET( SRC_BCI2000_FRAMEWORK "${SRC_BCI2000_FRAMEWORK}" "${SIGPROCSOURCES}" "${EXTRASOURCES}" )
SET( HDR_BCI2000_FRAMEWORK "${HDR_BCI2000_FRAMEWORK}" "${SIGPROCHEADERS}" "${EXTRAHEADERS}" )

SOURCE_GROUP( Source\\BCI2000_Framework\\shared\\modules\\signalprocessing FILES ${SIGPROCSOURCES} )
SOURCE_GROUP( Headers\\BCI2000_Framework\\shared\\modules\\signalprocessing FILES ${SIGPROCHEADERS} )

# Set the Project Source Groups
SOURCE_GROUP( Source\\Project FILES ${SOURCES} )
SOURCE_GROUP( Headers\\Project FILES ${HEADERS} )

BCI2000_SETUP_EXTLIB_DEPENDENCIES( SRC_BCI2000_FRAMEWORK HDR_BCI2000_FRAMEWORK LIBS )

# If we're building a Qt project, we need to automoc the sources
IF( NOT BORLAND )
SET(qtproject_SRCS
  ${SRC_BCI2000_FRAMEWORK}
  ${SOURCES}
)
QT4_AUTOMOC(${qtproject_SRCS})
INCLUDE( ${QT_USE_FILE} )
ENDIF( NOT BORLAND )

# Add to our include directories
INCLUDE_DIRECTORIES( ${BCI2000_SRC_DIR}/shared/modules/signalprocessing ${INCLUDES} )

# Add Pre-processor defines
ADD_DEFINITIONS( 
  -DMODTYPE=2
  -DNO_PCHINCLUDES
)
IF( WIN32 )
ADD_DEFINITIONS( -D_WINDOWS )
ENDIF( WIN32 )

# Add the executable to the project
ADD_EXECUTABLE( ${NAME} WIN32 ${SRC_BCI2000_FRAMEWORK} ${HDR_BCI2000_FRAMEWORK} ${SOURCES} ${HEADERS} )

# Set the output directories
SET_TARGET_PROPERTIES( ${NAME} PROPERTIES RUNTIME_OUTPUT_DIRECTORY ${BCI2000_ROOT_DIR}/prog )
SET_TARGET_PROPERTIES( ${NAME} PROPERTIES ARCHIVE_OUTPUT_DIRECTORY ${BCI2000_ROOT_DIR}/prog )
SET_TARGET_PROPERTIES( ${NAME} PROPERTIES LIBRARY_OUTPUT_DIRECTORY ${BCI2000_ROOT_DIR}/prog )
IF( MSVC OR XCODE )
  SET_TARGET_PROPERTIES( ${NAME} PROPERTIES 
    PREFIX "../"
    IMPORT_PREFIX "../" 
  )
ENDIF( MSVC OR XCODE )

# Link against the Qt/VCL Libraries
IF( BORLAND )
TARGET_LINK_LIBRARIES( ${NAME} vcl rtl ${VXL_VGUI_LIBRARIES} ${LIBS} )
ELSE( BORLAND )
TARGET_LINK_LIBRARIES( ${NAME} ${QT_LIBRARIES} ${LIBS} )
ENDIF( BORLAND )

ENDMACRO( BCI2000_ADD_SIGNAL_PROCESSING_MODULE NAME SOURCES HEADERS SIGPROCSOURCES SIGPROCHEADERS INCLUDES )